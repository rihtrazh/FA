<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
        }
        h3 {
            margin-top: 20px;
            color: #343a40;
        }
        .table {
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            word-wrap: break-word;
        }
        tr:hover {
            background-color: #e9ecef;
        }
        .btn {
            margin: 5px;
        }
        .author-info {
            background-color: #343a40;
            color: #ffffff;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
    </style>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h3>–ü–æ–∏—Å–∫ –≥—Ä—É–∑–∞ –ø–æ –ª—é–±–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é:</h3>
            <form th:action="@{/}">
                <input type="text" name="keyword" id="keyword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ" th:value="${keyword}" required/>
                <div class="mt-2">
                    <input type="submit" class="btn btn-success btn-sm" value="–ü–æ–∏—Å–∫"/>
                    <input type="button" class="btn btn-warning btn-sm" value="–û—á–∏—Å—Ç–∏—Ç—å" id="btnClear" onclick="clearSearch()"/>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive">
        <table id="cargoTable" class="table table-striped table-hover">
            <thead>
            <tr>
                <th scope="col">ID –≥—Ä—É–∑–∞</th>
                <th scope="col">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
                <th scope="col">–û–∂–∏–¥–∞–µ–º–æ–µ –ø—Ä–∏–±—ã—Ç–∏–µ</th>
                <th scope="col">–°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–∑–∫–∏</th>
                <th scope="col">–¢–∏–ø –≥—Ä—É–∑–∞</th>
                <th scope="col" class="sortable" onclick="sortTable(5)">–í–µ—Å<span style="cursor:pointer;">(üîºüîΩ)</span></th>
                <th scope="col">–û–±—ä–µ–º</th>
                <th scope="col">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                <th scope="col">–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è</th>
                <th scope="col">–¢–∞—Ä–∏—Ñ</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="cargo: ${cargoList}">
                <td class="text-black" th:text="${cargo.ID}"></td>
                <td class="text-black" th:text="${cargo.departureDate}"></td>
                <td class="text-black" th:text="${cargo.deliveryDate}"></td>
                <td class="text-black" th:text="${cargo.status}"></td>
                <td class="text-black" th:text="${cargo.cargoType}"></td>
                <td class="text-black" th:text="${cargo.weight} + ' –∫–≥'"></td>
                <td class="text-black" th:text="${cargo.volume} + ' –º¬≥'"></td>
                <td class="text-black" th:text="${cargo.sender}"></td>
                <td class="text-black" th:text="${cargo.recipientAddress}"></td>
                <td class="text-black" th:text="${cargo.deliveryRate}"></td>
                <td>
                    <a th:href="@{'/edit/'+${cargo.ID}}"><button type="button" class="btn btn-secondary btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></a>
                    <a th:href="@{'/delete/'+${cargo.ID}}"><button type="button" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div id="orderCount" style="text-align: center;">
        <h5>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: <span id="count">0</span></h5>
    </div>

    <div style="text-align: center">
        <a href="/new"><button type="button" class="btn btn-info">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button></a>
    </div>

    <div class="col-12 col-md-8 mx-auto">
        <canvas id="ordersChart"></canvas>
    </div>
</div>

<div class="author-info">
    <h5>–û–± –∞–≤—Ç–æ—Ä–µ —Å–∞–π—Ç–∞</h5>
    <p>–ü–æ—Å—Ç–Ω–∏–∫–æ–≤ –í–ª–∞–¥–∏—Å–ª–∞–≤ –î–º–∏—Ç—Ä–∏–µ–≤–∏—á, –Ω–∞—á–∏–Ω–∞—é—â–∏–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</p>
    <p>Email: <a href="mailto:222591@edu.fa.ru" class="text-white">222591@edu.fa.ru.</a></p>
    <p>–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã &copy; 2024</p>
</div>

<script type="text/javascript">
    function clearSearch() {
        window.location = "[[@{/}]]";
    }

    function sortTable(columnIndex) {
        const table = document.getElementById("cargoTable");
        const rows = Array.from(table.rows).slice(1);
        const isAscending = table.getAttribute("data-sort-order") === "asc";

        rows.sort((a, b) => {
            const aText = a.cells[columnIndex].innerText.replace(' –∫–≥', '').trim();
            const bText = b.cells[columnIndex].innerText.replace(' –∫–≥', '').trim();
            const aWeight = parseFloat(aText);
            const bWeight = parseFloat(bText);
            return isAscending ? aWeight - bWeight : bWeight - aWeight;
        });

        rows.forEach(row => table.appendChild(row));
        table.setAttribute("data-sort-order", isAscending ? "desc" : "asc");
    }

    function countOrders() {
        const tableBody = document.querySelector("#cargoTable tbody");
        const rowCount = tableBody.rows.length;
        document.getElementById("count").innerText = rowCount;
    }

    function createHistogram() {
        const tableBody = document.querySelector("#cargoTable tbody");
        const rows = Array.from(tableBody.rows);

        const monthlyCounts = Array(12).fill(0);

        rows.forEach(row => {
            const departureDate = row.cells[1].innerText;
            const month = new Date(departureDate).getMonth();
            monthlyCounts[month]++;
        });

        const ctx = document.getElementById('ordersChart').getContext('2d');
        const ordersChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [
                    '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                    '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
                ],
                datasets: [{
                    label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤',
                    data: monthlyCounts,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤'
                        },
                        ticks: {
                            stepSize: 1,
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–ú–µ—Å—è—Ü—ã'
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });
    }

    window.onload = function() {
        countOrders();
        createHistogram();
    };

</script>
</body>
</html>